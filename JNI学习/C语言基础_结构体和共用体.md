# C语言基础_结构体和共用体

## 1. 结构体

> 结构体是C编程中一种用户自定义的数据类型，类似于Java的JavaBean

#### 定义结构体

```
//Student 相当于类名
//student和a 可以不定义，表示结构变量，也就Student类型的变量
struct Student
{
	char name[50];
	int age;
} student,a;
//使用typedef定义
typedef struct{
    char name[50];
    int age;
} Stu
```

> 结构体占用的字节数与结构体内定义的字段有关，所以当传递一个结构体所占用的内存较大，而传递一个指针只占用4或8个字节，传递效率更加高效，所以平时使用的过程中通常都是以指针的方式传递；

#### 字节对齐



> 现代计算机中，内存空间按照字节划分，理论上可以从任何起始地址访问任意类型的变量。但实际中在访问特定类型变量时经常在特定的内存地址访问，这就需要各种类型数据按照一定的规则在空间上排列，而不是顺序一个接一个地存放，这就是对齐。 
>
> 某一个变量保存在结构体中的开始位置相对于结构体开始位置的偏移量是这个变量字节的整肃倍；



```
struct MyStruct1
{
	short a;  
	int b;	
	short c; 
};
struct MyStruct2
{
     short a;
	short c; 
	int b;
};
//自然对齐
//1、某个变量存放的起始位置相对于结构的起始位置的偏移量是该变量字节数的整数倍；
//2、结构所占用的总字节数是结构中字节数最长的变量的字节数的整数倍。
// short = 2  补 2
// int = 4
// short = 2  补 2
sizeof(MyStruct1) = 12
// 2个short在一起组成一个 4 
sizeof(MyStruct2) = 8
```



```
# pragma pack(2) //指定以2字节对齐

struct MyStruct1
{
	short a;  
	int b;	
	short c; 
};

# pragma pack()	//取消对齐

//short = 2
//int = 4
//short = 2
```

> 合理的利用字节可以有效地节省存储空间
>
> 不合理的则会浪费空间、降低效率甚至还会引发错误。(对于部分系统从奇地址访问int、short等数据会导致错误)



## 2.共用体



> 共用体就是利用相同的内存位置存储不同的变量值，它里面的成员公用一块内存，
>
> 其共用体的大小是所包含成员的所占字节最长的那个变量所占用的字节数

```
//占用4字节
union Data
{
	int i;
	short j;
}
union Data data;
data.i = 1;
printf("i的值为：%d\n"，data.i);
//i的数据损坏
data.j = 2.1f;
printf("i的值为：%d\n"，data.i);
printf("j的值为：%d\n"，data.j);
//这几句代码的输出是：1，2，2，在这块内存上重复赋值，只能取到最后一次赋值的值，上面赋值的都会被覆盖
```



## 3.C语言基础总结

##### 基本数据类型

基本数组类型和java类似，主要包含几个不同的点：

 1. 新增了signed和unsigned类型，long long类型，没有String类型

 2. 不同平台下个别基本数据类型（long和指针）所占用的字节不同，在32位long占4位，指针占4位，在64位平台下long占8位，指针占8位；

    



##### 格式化输出

格式化输出在java中被封装了，在C/C++中并未做封装，需要我们格式化输出，其中常用的是%d,%#x输出十六进制地址等；

##### 指针以及多级指针



指针就是指向一块内存的地址，也是变量只不过存放的是地址，这个地方有几个常见的野指针，悬空指针的概念需要理解，C/C++中切记定义一个变量之后要给赋值；

解引用以及取地址，以及指针的常见的运算；

##### 数组的定义

数组的定义就是需要指定长度或者直接赋值；

```
int arr[10];

int arr1[]={1,2,3}
```



##### 指针数组与数组指针

数组指针就是一个指向数组的指针，归根结底还是指针，而指针数组就是数组里面存放指针的数组而已；



```
int *arr[10];

int (*arr1)[10];
```

[]和()的优先级一样，比*的优先级要高，所以arr就是一个存放（int*）数据的指针，而arr1就是一个指针数组，指向数组首地址的；

##### 函数指针与指针函数

指针函数本质还是函数不过返回值是一个指针类型的，所以称之为指针函数，而一个函数指针就是指的一个变量了；

不过在C/C++中特别注意指针传递，引用传递以及值传递，值传递

##### 预处理器以及宏定义

预处理器就是做文本替换的，主要的用处就是在头文件中定义一些类或者结构体的时候用到#ifndfine #dinfin ....

##### 结构体

结构体和java中的javabean是一样的存放多类型的数据，不过在计算结构体大小的过程中要记得自然对齐的问题；两条规则：结构体的大小是结构体元素所占位数最大的那个的整数倍；每一个元素在内存中的分布开始位置是相对于初始值偏移量各自的整数倍

##### 共用体

共用体就是公用一块内存，注意不可多次赋值还取前面的赋值的值；